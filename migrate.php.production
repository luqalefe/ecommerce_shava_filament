<?php
/**
 * Script de MigraÃ§Ã£o para ProduÃ§Ã£o
 * 
 * EXECUTE UMA VEZ e DELETE IMEDIATAMENTE apÃ³s uso!
 * Acesse via navegador: https://seudominio.com.br/migrate.php
 */

// Caminho para o Laravel
$laravelPath = dirname(__DIR__) . '/laravel';

// Verificar senha
$password = 'SHAVA2024_DEPLOY'; // Altere esta senha!
if (!isset($_GET['key']) || $_GET['key'] !== $password) {
    die('âŒ Acesso negado. Use: migrate.php?key=' . $password);
}

// Carregar Laravel
require $laravelPath . '/vendor/autoload.php';
$app = require_once $laravelPath . '/bootstrap/app.php';
$kernel = $app->make(Illuminate\Contracts\Console\Kernel::class);
$kernel->bootstrap();

echo "<h1>ğŸ—„ï¸ Executando MigraÃ§Ãµes</h1>";
echo "<pre>";

try {
    // Executar migrations
    echo "ğŸ“¦ Executando migrations...\n";
    Artisan::call('migrate', ['--force' => true]);
    echo Artisan::output();
    echo "\nâœ… Migrations executadas!\n\n";
    
    // Criar link de storage
    echo "ğŸ”— Criando link de storage...\n";
    $target = $laravelPath . '/storage/app/public';
    $link = __DIR__ . '/storage';
    
    if (is_link($link) || file_exists($link)) {
        echo "âœ… Link de storage jÃ¡ existe\n";
    } elseif (symlink($target, $link)) {
        echo "âœ… Link de storage criado!\n";
    } else {
        echo "âš ï¸ NÃ£o foi possÃ­vel criar link simbÃ³lico\n";
    }
    
    echo "\n";
    echo "âœ… <strong>ConfiguraÃ§Ã£o concluÃ­da!</strong>\n";
    echo "\n";
    echo "âš ï¸ <strong>IMPORTANTE: DELETE ESTE ARQUIVO AGORA!</strong>\n";
    
} catch (Exception $e) {
    echo "âŒ Erro: " . $e->getMessage() . "\n";
    echo "Stack trace:\n" . $e->getTraceAsString() . "\n";
}

echo "</pre>";
